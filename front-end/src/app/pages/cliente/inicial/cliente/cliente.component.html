<p-card header="Minhas Solicitações">
  <ng-container *ngIf="!carregando; else loadingTpl">
    <p-table
      [value]="solicitacoes"
      [paginator]="true"
      [rows]="10"
      [rowsPerPageOptions]="[10,20,50]"
      [responsiveLayout]="'scroll'"
      [tableStyle]="{ 'min-width': '720px' }"
      [trackBy]="trackById"
      dataKey="id"
      emptyMessage="Nenhuma solicitação encontrada."
    >
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 220px;">Data/Hora</th>
          <th>Equipamento</th>
          <th style="width: 160px;">Estado</th>
          <th style="width: 320px; text-align: right;">Ações</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-s>
        <tr>
          <td>
            <!-- Formato pt-BR; ajuste timezone se necessário -->
            {{ s.createdAt | date:'dd/MM/yyyy HH:mm' }}
          </td>
          <td>
            <span pTooltip="{{ s.equipamentoDescricao }}" tooltipPosition="top">
              {{ truncar(s.equipamentoDescricao, 30) }}
            </span>
          </td>
          <td>
            <p-tag [value]="s.estado"></p-tag>
          </td>
          <td style="text-align: right;">
            <!-- Visualizar (RF008) sempre disponível -->
            <p-button
              label="Visualizar"
              icon="pi pi-eye"
              severity="info"
              [text]="true"
              class="mr-2"
              (onClick)="abrirDetalhe(s.id)">
            </p-button>

            <!-- Botão de ação condicional -->
            <ng-container *ngIf="getAcao(s.estado, s.id) as acao">
              <p-button
                *ngIf="acao"
                [label]="acao.label"
                icon="pi pi-arrow-right"
                routerLink="{{ acao.link }}"
                severity="secondary">
              </p-button>
            </ng-container>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </ng-container>

  <ng-template #loadingTpl>
    <p-skeleton width="100%" height="2rem" styleClass="mb-2"></p-skeleton>
    <p-skeleton width="100%" height="2rem" styleClass="mb-2"></p-skeleton>
    <p-skeleton width="100%" height="2rem"></p-skeleton>
  </ng-template>
</p-card>

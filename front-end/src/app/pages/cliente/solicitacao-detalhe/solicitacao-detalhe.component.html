<mat-card *ngIf="solicitacao as s; else notFound" class="det-card">
  <div class="hdr">
    <div class="hdr-left">
      <h2 class="title">Detalhe da Solicitação</h2>
      <span class="subtitle">Acompanhe as informações e o histórico</span>
    </div>
  </div>

  <div class="resume">
    <div class="chip">
      <mat-icon>event</mat-icon>
      <div>
        <span class="k">Abertura</span>
        <span class="v">{{ s.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
      </div>
    </div>

    <div class="chip">
      <mat-icon>payments</mat-icon>
      <div>
        <span class="k">Orçamento</span>
        <span class="v">
          <ng-container *ngIf="s.orcamentoValor != null; else aguardando">
            {{ s.orcamentoValor | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
          </ng-container>
          <ng-template #aguardando>—</ng-template>
        </span>
      </div>
    </div>
  </div>

  <mat-divider class="my-3"></mat-divider>

  <div class="grid2">
    <section class="box">
      <h4 class="box-title">Informações</h4>
      <dl class="kv">
        <div class="row"><dt>Abertura</dt><dd>{{ s.createdAt | date:'dd/MM/yyyy HH:mm' }}</dd></div>
        <div class="row"><dt>Estado</dt><dd>{{ s.estado }}</dd></div>
        <div class="row wrap">
          <dt>Equipamento</dt><dd>{{ s.descricaoProduto }}</dd>
        </div>
        <div class="row wrap" *ngIf="s.defeito">
          <dt>Defeito</dt><dd>{{ s.defeito }}</dd>
        </div>
      </dl>
    </section>

    <section class="box">
      <h4 class="box-title">Cliente</h4>
      <dl class="kv">
        <div class="row"><dt>Nome</dt><dd>{{ s.clienteNome }}</dd></div>
        <div class="row"><dt>E-mail</dt><dd>{{ s.clienteEmail }}</dd></div>
      </dl>
    </section>
  </div>

  <mat-divider class="my-3"></mat-divider>

  <h4>Histórico</h4>
  <table mat-table [dataSource]="solicitacao.historico || []" class="mat-elevation-z1 tabela w-100">
    <ng-container matColumnDef="quando">
      <th mat-header-cell *matHeaderCellDef>Data/Hora</th>
      <td mat-cell *matCellDef="let h">{{ h.quando | date:'dd/MM/yyyy HH:mm' }}</td>
    </ng-container>

    <ng-container matColumnDef="de">
      <th mat-header-cell *matHeaderCellDef>De</th>
      <td mat-cell *matCellDef="let h">{{ h.de }}</td>
    </ng-container>

    <ng-container matColumnDef="para">
      <th mat-header-cell *matHeaderCellDef>Para</th>
      <td mat-cell *matCellDef="let h">{{ h.para }}</td>
    </ng-container>

    <ng-container matColumnDef="funcionario">
      <th mat-header-cell *matHeaderCellDef>Funcionário</th>
      <td mat-cell *matCellDef="let h">{{ h.funcionario || '—' }}</td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>

  <mat-divider class="my-3"></mat-divider>

  <div class="actions">
    <button mat-stroked-button type="button" (click)="voltar()">Voltar</button>

    <ng-container *ngIf="podeAprovarOuRejeitar()">
      <button mat-raised-button color="primary" type="button" (click)="aprovar()">Aprovar Serviço</button>
      <button mat-raised-button color="warn" type="button" (click)="rejeitar()">Rejeitar Serviço</button>
    </ng-container>

    <ng-container *ngIf="podePagar()">
      <button mat-raised-button color="primary" type="button" (click)="pagar()">Pagar Serviço</button>
    </ng-container>
  </div>
</mat-card>

<ng-template #notFound>
  <mat-card class="det-card">
    <div class="hdr">
      <h2 class="title">Solicitação não encontrada</h2>
      <button mat-stroked-button type="button" (click)="voltar()">
        <mat-icon>arrow_back</mat-icon>
        Voltar
      </button>
    </div>
  </mat-card>
</ng-template>
